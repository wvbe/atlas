var HA={};HA.DEGTORAD=Math.PI/180,HA.TWOPI=2*Math.PI,HA.HALFPI=Math.PI/2,HA.Vector=function(t){if(void 0!==t.coords)this.x=t.coords[0],this.y=t.coords[1],this.z=t.coords[2];else{var s=Math.cos(t.decl);this.x=s*Math.cos(t.ra),this.y=s*Math.sin(t.ra),this.z=Math.sin(t.decl)}},HA.Vector.prototype.copy=function(){return new HA.Vector({coords:[this.x,this.y,this.z]})},HA.Vector.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},HA.Vector.prototype.latitude=function(){return Math.asin(this.z/this.mag())},HA.Vector.prototype.longitude=function(){return Math.atan2(this.y,this.x)},HA.Vector.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},HA.Vector.prototype.angleBetween=function(t){return Math.acos(this.dotProduct(t)/(this.mag()*t.mag()))},HA.Vector.prototype.scale=function(t){this.x*=t,this.y*=t,this.z*=t},HA.Vector.prototype.normalize=function(){this.scale(1/this.mag())},HA.Vector.prototype.add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},HA.Vector.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},HA.Vector.prototype.vectorProduct=function(t){return new HA.Vector({coords:[this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x]})},HA.Vector.prototype.rotateAboutXAxis=function(t){var s=Math.sin(t),e=Math.cos(t),i=this.y;this.y=e*i-s*this.z,this.z=s*i+e*this.z},HA.Vector.prototype.rotateAboutZAxis=function(t){var s=Math.sin(t),e=Math.cos(t),i=this.x;this.x=e*i-s*this.y,this.y=s*i+e*this.y},HA.Matrix=function(t){if(void 0!==t.axis){var s=Math.sin(t.angle),e=Math.cos(t.angle);0==t.axis?this.elems=[1,0,0,0,e,-s,0,s,e]:2==t.axis&&(this.elems=[e,-s,0,s,e,0,0,0,1])}else this.elems=t.elems},HA.Matrix.fromArbitraryAxisAndRotation=function(t,s){var e=t.x*t.x,i=t.y*t.y,o=t.z*t.z,a=Math.sin(s),r=Math.cos(s),n=1-r,h=e+(1-e)*r,l=t.x*t.y*n-t.z*a,c=t.x*t.z*n+t.y*a,d=t.x*t.y*n+t.z*a,p=i+(1-i)*r,A=t.y*t.z*n-t.x*a,u=t.x*t.z*n-t.y*a,g=t.y*t.z*n+t.x*a,y=o+(1-o)*r;return new HA.Matrix({elems:[h,l,c,d,p,A,u,g,y]})},HA.Matrix.prototype.vecMult=function(t){return new HA.Vector({coords:[this.elems[0]*t.x+this.elems[1]*t.y+this.elems[2]*t.z,this.elems[3]*t.x+this.elems[4]*t.y+this.elems[5]*t.z,this.elems[6]*t.x+this.elems[7]*t.y+this.elems[8]*t.z]})},HA.Matrix.prototype.transpose=function(){return new HA.Matrix({elems:[this.elems[0],this.elems[3],this.elems[6],this.elems[1],this.elems[4],this.elems[7],this.elems[2],this.elems[5],this.elems[8]]})},HA.Matrix.prototype.matMult=function(t){return new HA.Matrix({elems:[this.elems[0]*t.elems[0]+this.elems[1]*t.elems[3]+this.elems[2]*t.elems[6],this.elems[0]*t.elems[1]+this.elems[1]*t.elems[4]+this.elems[2]*t.elems[7],this.elems[0]*t.elems[2]+this.elems[1]*t.elems[5]+this.elems[2]*t.elems[8],this.elems[3]*t.elems[0]+this.elems[4]*t.elems[3]+this.elems[5]*t.elems[6],this.elems[3]*t.elems[1]+this.elems[4]*t.elems[4]+this.elems[5]*t.elems[7],this.elems[3]*t.elems[2]+this.elems[4]*t.elems[5]+this.elems[5]*t.elems[8],this.elems[6]*t.elems[0]+this.elems[7]*t.elems[3]+this.elems[8]*t.elems[6],this.elems[6]*t.elems[1]+this.elems[7]*t.elems[4]+this.elems[8]*t.elems[7],this.elems[6]*t.elems[2]+this.elems[7]*t.elems[5]+this.elems[8]*t.elems[8]]})},HA.Astro={},HA.Astro.RATORAD=Math.PI/12,HA.Astro.ARCSECTORAD=HA.DEGTORAD/3600,HA.Astro.OBLIQUITY_2000=23.43929111*HA.DEGTORAD,HA.Astro.J2000_TIME=946728e6,HA.Astro.EARTH_RADIUS=6378,HA.Astro.AU=149597870.66,HA.Astro.gha=function(t){var s=HA.Astro.getCenturiesSinceJ2000(t),e=24110.54841+(8640184.812866+(.093104-62e-7*s)*s)*s;return(e=(e+=t%864e5*.001)/13750.987%HA.TWOPI)<0&&(e+=HA.TWOPI),e},HA.Astro.getCenturiesSinceJ2000=function(t){return(t-HA.Astro.J2000_TIME)/315576e7},HA.Astro.getPrecessionMatrix=function(t){var s=HA.Astro.getCenturiesSinceJ2000(t),e=s*s,i=e*s,o=(.6406161*s+839e-7*e+5e-6*i)*HA.DEGTORAD,a=(.6406161*s+3041e-7*e+51e-7*i)*HA.DEGTORAD,r=(.556753*s-1185e-7*e-116e-7*i)*HA.DEGTORAD,n=Math.cos(o),h=Math.sin(o),l=Math.cos(a),c=Math.sin(a),d=Math.cos(r),p=Math.sin(r);return new HA.Matrix({elems:[n*d*l-h*c,-h*d*l-n*c,-p*l,n*d*c+h*l,-h*d*c+n*l,-p*c,n*p,-h*p,d]})},HA.Astro.to1875=HA.Astro.getPrecessionMatrix(new Date(1875,0,1).getTime()),HA.Astro.from1875=HA.Astro.to1875.transpose(),HA.Astro.formatLatLong=function(t,s){var e=Math.round(60*t),i=e<0?"S":"N";e=Math.abs(e);var o=Math.floor(e/60),a=Math.floor(e%60),r="Latitude: "+o+"° "+a+"' "+i+"  Longitude: ";return i=(e=Math.round(60*s))<0?"W":"E",e=Math.abs(e),r+(o=Math.floor(e/60))+"° "+(a=Math.floor(e%60))+"' "+i},HA.Astro.formatDecl=function(t){var s=Math.round(60*t/HA.DEGTORAD),e=s<0?"-":"";return s=Math.abs(s),e+Math.floor(s/60)+"° "+Math.floor(s%60)+"'"},HA.Astro.formatRA=function(t){var s=t/this.RATORAD;s<0&&(s+=24);var e=Math.round(60*s);return Math.floor(e/60)+"h "+Math.floor(e%60)+"m"},HA.Astro.constellationFromCelestialPoint=function(t,s){var e=HA.Astro.to1875.vecMult(t),i=Math.round(Math.floor(e.longitude()/HA.Astro.ARCSECTORAD/15));i<0&&(i+=86400);var o=Math.round(Math.ceil(e.latitude()/HA.Astro.ARCSECTORAD));for(regIX=0;regIX<s.length;regIX+=4)if(o>=s[regIX+2]&&i>=s[regIX]&&i<s[regIX+1])return s[regIX+3];return null},HA.Astro.reduceAngleDegrees=function(t){for(;t<0;)t+=360;for(;360<t;)t-=360;return t},HA.PositionPoly=function(t,s,e){this.order=e.length/3-1,this.comps=3,this.coeffs=e,this.midRange=(t+s)/2,this.halfInterval=(s-t)/2},HA.PositionPoly.prototype.evaluate=function(t){var s=new Array,e=(t-this.midRange)/this.halfInterval,i=2*e,o=new Array;for(o[0]=1,o[1]=e,j=2;j<=this.order;j++)o[j]=i*o[j-1]-o[j-2];for(c=0;c<this.comps;c++)for(s[c]=.5*this.coeffs[c],j=1;j<=this.order;j++)s[c]+=this.coeffs[j*this.comps+c]*o[j];return new HA.Vector({coords:s})},HA.SkyChart=function(t){this.version="0.1",this.canvas=document.getElementById(t.canvasID),this.context=this.canvas.getContext("2d"),this.cul=t.culture,void 0===this.cul&&(this.cul="en"),this.dynamicBlocks={},this.settingsKey="skyChart_ST_settings";var s=localStorage[this.settingsKey];null==s?(this.settings=new Object,this.settings.lat=48,this.settings.lng=11,this.settings.mag=3.5,this.settings.showConsNames=!0,this.settings.showStarNames=!0,this.settings.showEcliptic=!0,this.settings.showEquator=!1,this.settings.showConstellationLines=!0,this.settings.showConstellationBoundaries=!1,this.settings.showPlanetLabels=!0,localStorage[this.settingsKey]=JSON.stringify(this.settings)):this.settings=JSON.parse(s),this.time=(new Date).getTime(),this.latitude=t.latitude*HA.DEGTORAD,this.longitude=t.longitude*HA.DEGTORAD,this.mousePos=null,this.selectedObject=null,this.mousePosVisible=!1;var e=this,i=!1;null==localStorage.staticData?i=!0:(this.staticData=JSON.parse(localStorage.staticData),(void 0===this.staticData.version||this.staticData.version<3)&&(i=!0)),$.getJSON("StringsForJSON.ashx?cul="+this.cul,function(t){e.strings=t,e.render()}),i&&$.getJSON("json/SkyChartStaticData3.json",function(t){e.onStaticDataReceived(t)}),this.canvas.addEventListener("mousemove",function(t){e.onMouseMove(t)},!1)},HA.SkyChart.prototype.getDynamicDataBlockForTime=function(t){var s=Math.floor(t/864e5).toFixed();if(isNaN(s))return null;var e="b"+s;if(void 0!==this.dynamicBlocks[e])return this.dynamicBlocks[e];this.dynamicBlocks[e]={loaded:!1};var i=this;return $.getJSON("GetSkyChartDynamicData.ashx?blockID="+e,function(t){i.onDynamicBlockReceived(e,t)}),this.dynamicBlocks[e]},HA.SkyChart.prototype.onDynamicBlockReceived=function(t,s){this.dynamicBlocks[t].data=s,this.dynamicBlocks[t].loaded=!0,this.render()},HA.SkyChart.prototype.saveSettings=function(){localStorage[this.settingsKey]=JSON.stringify(this.settings)},HA.SkyChart.prototype.onMouseMove=function(t){var s=this.getMousePos(t);this.mousePos=this.canvasToSky(s),this.mouseTopo=this.canvasToTopo(s);var e=null,i=100;for(var o in this.visibleObjects)if(this.visibleObjects.hasOwnProperty(o)){var a=this.visibleObjects[o],r=s.x-a.x,n=s.y-a.y,h=r*r+n*n;h<i&&(e=o,i=h)}if(e!==this.selectedObject){this.selectedObject=e;var l=this,c=e?500:0;this.timerID=window.setTimeout(function(){l.showPopup()},c),this.render()}},HA.SkyChart.prototype.getMousePos=function(t){var s=this.canvas.getBoundingClientRect();return{x:(t.clientX-s.left)/(s.right-s.left)*this.canvas.width,y:(t.clientY-s.top)/(s.bottom-s.top)*this.canvas.height}},HA.SkyChart.prototype.drawStar=function(t,s,e,o,a,r){t.beginPath();var n=HA.TWOPI/r;for(t.moveTo(s,e-a),i=0;i<r;i++){var h=(i+.5)*n;t.lineTo(s+o*Math.sin(h),e-o*Math.cos(h)),h=(i+1)*n,t.lineTo(s+a*Math.sin(h),e-a*Math.cos(h))}t.lineTo(s,e-a)},HA.SkyChart.prototype.render=function(){this.visibleObjects={},this.x0=this.canvas.width/2,this.y0=this.canvas.height/2,this.radius=.95*this.x0,this.radsPerPixel=Math.PI/(2*this.radius);var t=this.x0,s=this.y0,e=this.radius,o=this.context,a=this.longitude+HA.Astro.gha(this.time),r=this.latitude,n=new HA.Vector({ra:a,decl:r});n.scale(HA.Astro.EARTH_RADIUS);var h=new HA.Vector({ra:a,decl:r});this.rotMatrix=HA.Astro.getPrecessionMatrix(this.time);var l=this.rotMatrix.transpose();if(this.rotMatrix=new HA.Matrix({axis:2,angle:HA.HALFPI-a}).matMult(this.rotMatrix),this.rotMatrix=new HA.Matrix({axis:0,angle:-r-HA.HALFPI}).matMult(this.rotMatrix),this.rotMatrixInv=this.rotMatrix.transpose(),this.zenith=l.vecMult(h),void 0!==this.strings){o.beginPath(),o.rect(0,0,this.canvas.width,this.canvas.height),o.fillStyle="white",o.fill(),o.fillStyle="#c0c0c0",o.beginPath(),o.arc(t,s,this.canvas.width/2,0,HA.TWOPI),o.fill();var c=o.createRadialGradient(t,s,.8*e,e,s,t);c.addColorStop(0,"black"),c.addColorStop(1,"#0000c0"),o.fillStyle=c,o.beginPath(),o.arc(t,s,e,0,HA.TWOPI),o.stroke(),o.fill(),o.beginPath(),o.arc(t,s,this.canvas.width/2,0,HA.TWOPI),o.stroke(),o.font="11px Arial",o.fillStyle="black",o.textBaseline="bottom",o.textAlign="center";var d=e+4;for(az=10;az<360;az+=10)if(az%90!=0){o.save();var A=az*HA.DEGTORAD,u=90<az&&az<270;x=t-d*Math.sin(A),y=s-d*Math.cos(A),o.translate(x,y),o.rotate(u?Math.PI-A:-A),o.translate(-x,-y),o.textBaseline=u?"top":"bottom",o.fillText(az.toFixed()+"°",x,y),o.restore(),o.beginPath(),x=t-e*Math.sin(A),y=s-e*Math.cos(A),o.moveTo(x,y),x=t-d*Math.sin(A),y=s-d*Math.cos(A),o.lineTo(x,y),o.stroke()}if(o.font="18px Arial",o.textAlign="center",o.textBaseline="bottom",o.fillText(this.strings["compass.N"],t,s-e),o.textBaseline="top",o.fillText(this.strings["compass.S"],t,s+e),o.save(),o.translate(t-e,s),o.rotate(-Math.PI/2),o.translate(e-t,-s),o.textBaseline="bottom",o.fillText(this.strings["compass.E"],t-e,s),o.restore(),o.save(),o.translate(t+e,s),o.rotate(Math.PI/2),o.translate(-t-e,-s),o.textBaseline="bottom",o.fillText(this.strings["compass.W"],t+e,s),o.restore(),o.save(),o.beginPath(),o.arc(t,s,e,0,HA.TWOPI,!0),o.clip(),void 0!==this.staticData){if(this.settings.showConstellationBoundaries){o.strokeStyle="#808000";var g=this.staticData.cons;for(var m in g)if(g.hasOwnProperty(m)){var f=g[m].bounds;for(o.beginPath(),b=0;b<f.length;b++){var v=f[b];for(bp=0;bp<v.length-3;bp+=2)this.drawBoundarySeg({ra1:v[bp],dec1:v[bp+1],ra2:v[bp+2],dec2:v[bp+3]})}this.drawBoundarySeg({ra1:v[v.length-2],dec1:v[v.length-1],ra2:v[0],dec2:v[1]}),o.stroke()}}if(this.settings.showEcliptic){for(o.strokeStyle="magenta",o.beginPath(),iDeg=0;iDeg<361;++iDeg){var H=new HA.Vector({ra:iDeg*HA.DEGTORAD,decl:0});H.rotateAboutXAxis(HA.Astro.OBLIQUITY_2000);var T=this.skyToCanvas(H);-.2<H.dotProduct(this.zenith)&&0<iDeg?o.lineTo(T.x,T.y):o.moveTo(T.x,T.y)}o.stroke()}if(this.settings.showEquator){for(o.strokeStyle="white",o.beginPath(),iDeg=0;iDeg<361;++iDeg){var P=l.vecMult(new HA.Vector({ra:iDeg*HA.DEGTORAD,decl:0}));T=this.skyToCanvas(P);-.2<P.dotProduct(this.zenith)&&0<iDeg?o.lineTo(T.x,T.y):o.moveTo(T.x,T.y)}o.stroke()}var M=this.staticData.stars,D=this.staticData.lines;if(this.settings.showConstellationLines){for(o.strokeStyle="red",o.beginPath(),constell=0;constell<D.length;constell++)for(i=0;i<D[constell].length;i++){var S=M["s"+D[constell][i]][0],k=M["s"+D[constell][i]][1],O=new HA.Vector({ra:S,decl:k});T=this.skyToCanvas(O);0==i||O.dotProduct(this.zenith)<-.5?o.moveTo(T.x,T.y):o.lineTo(T.x,T.y)}o.stroke()}for(var w in o.strokeStyle="white",o.fillStyle="white",M){S=M[w][0],k=M[w][1];if(0<(O=new HA.Vector({ra:S,decl:k})).dotProduct(this.zenith)){T=this.skyToCanvas(O);var C=5-M[w][2];e=C*C*(this.radius/4e3),e=C<.5?.5:C,o.beginPath(),o.arc(T.x,T.y,e,0,HA.TWOPI),o.fill(),this.visibleObjects[w]=T}}if(this.settings.showConsNames&&null!=this.strings){o.fillStyle="#808000",o.font="11px Arial",o.textAlign="center",o.textBaseline="middle";g=this.staticData.cons;for(var m in g)if(g.hasOwnProperty(m)){var R=g[m];S=R.ra,k=R.dec,O=new HA.Vector({ra:S,decl:k}),T=this.skyToCanvas(O);0<O.dotProduct(this.zenith)&&o.fillText(this.strings["con."+m],T.x,T.y)}}if(this.settings.showStarNames)for(o.fillStyle="#808080",o.font="11px Arial",o.textAlign="left",o.textBaseline="middle",ix=0;ix<this.staticData.starNames.length;ix++){var z=M[w=this.staticData.starNames[ix]][7];S=M[w][0],k=M[w][1],O=new HA.Vector({ra:S,decl:k}),T=this.skyToCanvas(O),0<O.dotProduct(this.zenith)&&o.fillText(z,T.x+7,T.y)}var I=this.getDynamicDataBlockForTime(this.time);if(I&&I.loaded){var j=new HA.PositionPoly(I.data.t1,I.data.t2,I.data.sun);if(this.sunPos=j.evaluate(this.time),0<this.sunPos.dotProduct(this.zenith)){T=this.skyToCanvas(this.sunPos);var $=6;this.drawStar(o,T.x,T.y,$,12,8),o.strokeStyle="red",o.fillStyle="orange",o.stroke(),o.fill(),o.beginPath(),o.arc(T.x,T.y,$,0,HA.TWOPI),o.fillStyle="yellow",o.stroke(),o.fill(),this.visibleObjects.Sun=T}if(j=new HA.PositionPoly(I.data.t1,I.data.t2,I.data.moon),this.moonPos=j.evaluate(this.time),this.moonPos.subtract(n),0<this.moonPos.dotProduct(this.zenith)){T=this.skyToCanvas(this.moonPos);$=6;o.beginPath(),o.arc(T.x,T.y,$,0,HA.TWOPI),o.fillStyle="gray",o.fill(),this.visibleObjects.moon=T}for(o.textAlign="left",o.font="11px Arial",o.textBaseline="middle",o.fillStyle="orange",p=0;p<I.data.planets.length;p++){O=(j=new HA.PositionPoly(I.data.t1,I.data.t2,I.data.planets[p].cp)).evaluate(this.time);if(T=this.skyToCanvas(O),0<O.dotProduct(this.zenith)){o.beginPath();$=4;var B="planet."+I.data.planets[p].name;o.arc(T.x,T.y,$,0,HA.TWOPI),o.fill(),this.settings.showPlanetLabels&&o.fillText(this.strings[B],T.x+$+2,T.y),this.visibleObjects[B]=T}}this.selectedObject&&(T=this.visibleObjects[this.selectedObject],o.strokeStyle="#00ff00",o.beginPath(),o.arc(T.x,T.y,8,0,HA.TWOPI),o.stroke())}}}},HA.SkyChart.prototype.skyFrom1875=function(t,s){return HA.Astro.from1875.vecMult(new HA.Vector({ra:t/3600*HA.Astro.RATORAD,decl:s/3600*HA.DEGTORAD}))},HA.SkyChart.prototype.showPopup=function(){if(this.hidePopup(),this.selectedObject){var t=this.visibleObjects[this.selectedObject],s=t.x,e=t.y;if($("#container").append('<div id="popup" class="popup" />'),$("#popup").append('<table id="popTbl" class="standardTable" />'),"s"==this.selectedObject.substring(0,1)){var i,o=this.staticData.stars[this.selectedObject],a=HA.Astro.constellationFromCelestialPoint(new HA.Vector({ra:o[0],decl:o[1]}),this.staticData.conRegions),r=this.staticData.cons[a].gen,n=1e3/(.3066*o[4]);i=100<=n?0:10<=n?1:2,7<o.length?$("#popTbl").append('<thead><tr><td colspan="2">'+o[7]+", "+o[6]+" "+r+"</td></tr></thead>"):6<o.length?$("#popTbl").append('<thead><tr><td colspan="2">'+o[6]+" "+r+"</td></tr></thead>"):$("#popTbl").append('<thead><tr><td colspan="2">'+this.strings.star+"</td></tr></thead><tbody>"),$("#popTbl").append("<tr><td>"+this.strings.Magnitude+"</td><td>"+o[2]+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings["spectral.type"]+"</td><td>"+o[3]+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Range+"</td><td>"+n.toFixed(i)+" "+this.strings["light.years"]+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings["Right Ascension"]+"</td><td>"+HA.Astro.formatRA(o[0])+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Declination+"</td><td>"+HA.Astro.formatDecl(o[1])+"</td></tr>"),$("#popTbl").append("<tr><td>HIP</td><td>"+this.selectedObject.substring(1)+"</td></tr>")}else if("moon"==this.selectedObject)$("#popTbl").append('<thead><tr><td colspan="2">'+this.strings[this.selectedObject]+"</td></tr></thead><tbody>"),$("#popTbl").append("<tr><td>"+this.strings.Range+"</td><td>"+this.moonPos.mag().toFixed()+" "+this.strings.km+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings["Right Ascension"]+"</td><td>"+HA.Astro.formatRA(this.moonPos.longitude())+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Declination+"</td><td>"+HA.Astro.formatDecl(this.moonPos.latitude())+"</td></tr>");else if("Sun"==this.selectedObject)$("#popTbl").append('<thead><tr><td colspan="2">'+this.strings.sun+"</td></tr></thead><tbody>"),$("#popTbl").append("<tr><td>"+this.strings.Range+"</td><td>"+(this.sunPos.mag()/HA.Astro.AU).toFixed(3)+" "+this.strings.AU+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings["Right Ascension"]+"</td><td>"+HA.Astro.formatRA(this.sunPos.longitude())+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Declination+"</td><td>"+HA.Astro.formatDecl(this.sunPos.latitude())+"</td></tr>");else if("planet"==this.selectedObject.substring(0,6)){var h,l=this.getDynamicDataBlockForTime(this.time);if(l&&l.loaded){for(var c=0;c<l.data.planets.length&&"planet."+(h=l.data.planets[c]).name!=this.selectedObject;c++);var d=new HA.PositionPoly(l.data.t1,l.data.t2,h.cp).evaluate(this.time);$("#popTbl").append('<thead><tr><td colspan="2">'+this.strings[this.selectedObject]+"</td></tr></thead><tbody>"),$("#popTbl").append("<tr><td>"+this.strings.Magnitude+"</td><td>"+h.mag.toFixed(2)+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Range+"</td><td>"+(d.mag()/HA.Astro.AU).toFixed(3)+" "+this.strings.AU+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings["Right Ascension"]+"</td><td>"+HA.Astro.formatRA(d.longitude())+"</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Declination+"</td><td>"+HA.Astro.formatDecl(d.latitude())+"</td></tr>")}}var p=this.canvasToTopo(t),A=90-p.longitude()/HA.DEGTORAD;A<0&&(A+=360);var u=this.canvasToSky(t),g=(a=HA.Astro.constellationFromCelestialPoint(u,this.staticData.conRegions),this.strings["con."+a]);$("#popTbl").append("<tr><td>"+this.strings.altitude+"</td><td>"+HA.Astro.formatDecl(p.latitude())+"°</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Azimuth+"</td><td>"+A.toFixed(1)+"°</td></tr>"),$("#popTbl").append("<tr><td>"+this.strings.Constellation+"</td><td>"+g+"</td></tr>"),$("#popTbl").append("</tbody>");s>this.canvas.width/2?$("#popup").css({right:(this.canvas.width-s+10).toFixed()+"px"}):$("#popup").css({left:(s+10).toFixed()+"px"}),e>this.canvas.height/2?$("#popup").css({bottom:(this.canvas.height-e+10).toFixed()+"px"}):$("#popup").css({top:(e+10).toFixed()+"px"}),$("#popup").show()}},HA.SkyChart.prototype.hidePopup=function(){$("#popup").remove()},HA.SkyChart.prototype.drawBoundarySeg=function(t){var s=this.skyFrom1875(t.ra1,t.dec1),e=this.skyFrom1875(t.ra2,t.dec2);if(!(s.dotProduct(this.zenith)<-.2&&e.dotProduct(this.zenith)<-.2)){var i=this.skyToCanvas(s);if(this.context.moveTo(i.x,i.y),t.ra1==t.ra2)for(var o=t.dec2>t.dec1?7200:-7200,a=t.dec1+o;a<t.dec1!=a<t.dec2;)i=this.skyToCanvas(this.skyFrom1875(t.ra1,a)),this.context.lineTo(i.x,i.y),a+=o;else{43200<Math.abs(t.ra1-t.ra2)&&(t.ra1<43200?t.ra1+=86400:t.ra2+=86400);for(var r=t.ra2>t.ra1?480:-480,n=t.ra1+r;n<t.ra1!=n<t.ra2;)i=this.skyToCanvas(this.skyFrom1875(n,t.dec1)),this.context.lineTo(i.x,i.y),n+=r}i=this.skyToCanvas(e);this.context.lineTo(i.x,i.y)}},HA.SkyChart.prototype.skyToCanvas=function(t){var s=this.rotMatrix.vecMult(t),e=Math.PI/2+s.latitude(),i=s.longitude();return{x:this.x0+e*Math.cos(i)/this.radsPerPixel,y:this.y0-e*Math.sin(i)/this.radsPerPixel}},HA.SkyChart.prototype.canvasToSky=function(t){var s=t.x-this.x0,e=this.y0-t.y,i=Math.sqrt(s*s+e*e);if(i>this.radius)return null;var o=-HA.HALFPI+i*this.radsPerPixel,a=Math.atan2(e,s),r=new HA.Vector({ra:a,decl:o});return this.rotMatrixInv.vecMult(r)},HA.SkyChart.prototype.canvasToTopo=function(t){var s=t.x-this.x0,e=this.y0-t.y,i=Math.sqrt(s*s+e*e);if(i>this.radius)return null;var o=HA.HALFPI-i*this.radsPerPixel,a=Math.atan2(e,-s);return new HA.Vector({ra:a,decl:o})},HA.SkyChart.prototype.onStaticDataReceived=function(t){this.staticData=t,this.render(),localStorage.staticData=JSON.stringify(t)};